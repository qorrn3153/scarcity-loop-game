<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ğŸ’« ê²°í•ì˜ ê³ ë¦¬: ë¬´í•œ ì‚¬ì´í´ ğŸ’«</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f8ff;
      text-align: center;
      padding: 15px 10px;
      margin: 0 auto;
      max-width: 100%;
      box-sizing: border-box;
    }
    h1 {
      color: #333;
      font-size: 1.8em;
      margin-bottom: 10px;
      line-height: 1.2em;
    }
    #ai {
      font-style: italic;
      color: #444;
      margin-bottom: 20px;
      animation: blink 2s infinite;
      font-size: 1em;
      min-height: 1.4em;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    #result {
      font-size: 1.2em;
      margin: 15px 0;
      min-height: 45px;
      font-weight: bold;
    }
    #points, #gold, #wallet, #highscore, #daily {
      font-size: 1.1em;
      margin-bottom: 6px;
      color: #222;
    }
    #daily {
      font-size: 1em;
      margin: 12px 0 15px;
      color: #2d68c4;
    }
    button {
      padding: 14px 0;
      font-size: 1.3em;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.15s ease;
      width: 90vw;
      max-width: 320px;
      margin: 8px auto;
      display: block;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover {
      background-color: #218838;
      transform: scale(1.05);
    }
    button:disabled {
      background-color: #94d3a2;
      cursor: default;
      transform: none;
    }
    #history {
      margin-top: 20px;
      max-height: 220px;
      overflow-y: auto;
      border-top: 1px solid #ccc;
      padding-top: 12px;
      color: #666;
      font-size: 0.9em;
      text-align: left;
      line-height: 1.3em;
      max-width: 90vw;
      margin-left: auto;
      margin-right: auto;
    }
    .good { color: green; }
    .bad { color: red; }
    .neutral { color: gray; }

    #shop {
      margin-top: 25px;
      max-width: 90vw;
      margin-left: auto;
      margin-right: auto;
    }
    #shop h3 {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    #shop button {
      width: 100%;
      margin: 6px 0;
      font-size: 1.1em;
      border-radius: 10px;
      background-color: #007bff;
    }
    #shop button:hover {
      background-color: #0056b3;
    }

    #loot-display {
      margin-top: 25px;
      padding: 12px 8px;
      background-color: #ffffffcc;
      border-radius: 12px;
      max-width: 90vw;
      margin-left: auto;
      margin-right: auto;
      user-select: none;
    }
    #loot-display h3 {
      margin-bottom: 10px;
      font-size: 1.3em;
    }
    .loot-item {
      display: inline-block;
      width: 90px;
      margin: 4px 5px;
      font-size: 0.95em;
      font-weight: 600;
      color: #222;
    }
    #shareBtn {
      margin-top: 25px;
      background-color: #ffca28;
      color: #333;
      font-weight: 700;
      border-radius: 14px;
      max-width: 320px;
      width: 90vw;
    }
    #shareBtn:hover {
      background-color: #ffb300;
    }
  </style>
</head>
<body>
  <h1>ğŸ’« ê²°í•ì˜ ê³ ë¦¬: ë¬´í•œ ì‚¬ì´í´ ğŸ’«</h1>
  <div id="ai">ğŸ§  AI ì¡°ì–¸ì: "ê¸°íšŒëŠ” ìœ„í—˜ì„ ë™ë°˜í•©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì„ íƒì€ ê³¼ì—°...?"</div>
  <div id="points">ğŸ’° ì ìˆ˜: <span id="score">0</span>ì </div>
  <div id="gold">ğŸª™ ê³¨ë“œ: <span id="goldAmount">0</span>G</div>
  <div id="wallet">ğŸ‘œ ì§€ê°‘: <span id="walletGold">0</span>G</div>
  <div id="highscore">ğŸ† ìµœê³  ê¸°ë¡: <span id="highScore">0</span>ì </div>
  <div id="daily">ğŸ“† ì˜¤ëŠ˜ì˜ ë¯¸ì…˜: 20ë²ˆ ì‹œë„í•´ë³´ê¸° (ì§„í–‰: <span id="tries">0</span>/20)</div>
  <div id="result">ê¸°íšŒë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
  <button id="clickBtn">ğŸ” ì‹œë„í•˜ê¸°</button>
  <button id="resetBtn" style="display:none;">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
  <div id="history"></div>

  <div id="loot-display">
    <h3>ğŸ“¦ ì „ë¦¬í’ˆ</h3>
    <div id="lootList"></div>
    <p style="font-size: 0.8em; color: #666; margin-top: 8px;">
      íšë“ë¥ : ë‹¤ì´ì•„ëª¬ë“œ 0.5%, ì—ë©”ë„ë“œ 0.5%, ì•„ì¿ ì•„ë§ˆë¦° 0.5%, ì‚¬íŒŒì´ì–´ 0.5%, ììˆ˜ì • 0.5%, í‘ìš”ì„ 0.5%, ê¸ˆ 0.5%, ì€ 0.5%, ì˜¤íŒ” 0.5%, ë ˆì¸ë³´ìš° ë‹¤ì´ì•„ëª¬ë“œ 0.001%
    </p>
  </div>

  <div id="shop">
    <h3>ğŸ›’ ì•„ì´í…œ ìƒì </h3>
    <button onclick="buyItem('double', 100)">ğŸ ë”ë¸” ì°¬ìŠ¤ (100G)</button>
    <button onclick="buyItem('shield', 100)">ğŸ›¡ï¸ ì†ì‹¤ ë°©ì–´ (100G)</button>
    <button onclick="buyItem('jackpot100', 1000)">ğŸ’¥ 1% í™•ë¥  ê³¨ë“œ 100ë°° (20íšŒ, 1000G)</button>
    <button onclick="buyItem('jackpot10', 500)">ğŸ’¥ 10% í™•ë¥  ê³¨ë“œ 10ë°° (20íšŒ, 500G)</button>
    <button onclick="buyItem('extraTurns', 500)">ğŸ” ë‹¤ìŒ ê²Œì„ +10íšŒ (500G)</button>
    <button onclick="buyItem('lootBoost', 1000)">ğŸ’ ì „ë¦¬í’ˆ í™•ë¥  +5% (ë‹¤ìŒ ê²Œì„, 1000G)</button>
  </div>

  <button id="shareBtn" title="ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê¸°ë¡ ê³µìœ ">ğŸ“¤ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê³µìœ í•˜ê¸°</button>

<script>
  const MAX_TRIES_BASE = 20;
  let extraTurns = parseInt(localStorage.getItem('extraTurns') || '0');
  let lootBoost = parseInt(localStorage.getItem('lootBoost') || '0');
  let MAX_TRIES = MAX_TRIES_BASE + extraTurns;

  let score = 0;
  let gold = 0;
  let walletGold = 0;
  let tries = 0;
  let highScore = parseInt(localStorage.getItem('highScore')) || 0;

  let shield = false;
  let double = false;
  let jackpot100 = false;
  let jackpot10 = false;

  // ì „ë¦¬í’ˆ íšë“ í™•ë¥  0.5% ê³ ì • (ë ˆì¸ë³´ìš° ë‹¤ì´ì•„ëª¬ë“œë§Œ 0.001%)
  const lootRates = {
    'ë ˆì¸ë³´ìš° ë‹¤ì´ì•„ëª¬ë“œ': 0.001,
    'ë‹¤ì´ì•„ëª¬ë“œ': 0.5,
    'ì—ë©”ë„ë“œ': 0.5,
    'ì•„ì¿ ì•„ë§ˆë¦°': 0.5,
    'ì‚¬íŒŒì´ì–´': 0.5,
    'ììˆ˜ì •': 0.5,
    'í‘ìš”ì„': 0.5,
    'ì˜¤íŒ”': 0.5,
    'ê¸ˆ': 0.5,
    'ì€': 0.5
  };

  // ì „ë¦¬í’ˆ ë³´ê´€, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥
  let lootInventory = JSON.parse(localStorage.getItem('lootInventory')) || {};
  for (const item in lootRates) {
    if (!lootInventory[item]) lootInventory[item] = 0;
  }

  const updateUI = () => {
    document.getElementById('score').textContent = score;
    document.getElementById('goldAmount').textContent = gold;
    document.getElementById('walletGold').textContent = walletGold;
    document.getElementById('tries').textContent = tries;
    document.getElementById('highScore').textContent = highScore;

    // ì „ë¦¬í’ˆ UI ì—…ë°ì´íŠ¸
    const lootList = document.getElementById('lootList');
    lootList.innerHTML = '';
    for (const item in lootInventory) {
      const div = document.createElement('div');
      div.className = 'loot-item';
      div.textContent = lootInventory[item] > 0 ? `${item} x${lootInventory[item]}` : '?';
      lootList.appendChild(div);
    }
  };

  // ì „ë¦¬í’ˆ íšë“ í•¨ìˆ˜ (í™•ë¥  + ë¶€ìŠ¤í„° ë°˜ì˜)
  const getLoot = () => {
    const roll = Math.random() * 100;
    let cumulative = 0;
    for (const item in lootRates) {
      let rate = lootRates[item];
      if (lootBoost) rate += 5;
      cumulative += rate;
      if (roll <= cumulative) {
        return item;
      }
    }
    return null;
  };

  // AI ë©˜íŠ¸ ëœë¤ ì¶œë ¥
  const aiSay = (type) => {
    const phrases = {
      good: ['ì¢‹ì€ ê¸°íšŒì˜€ë„¤ìš”!', 'ìš´ì´ ë”°ë¥´ë„¤ìš”!', 'ê³„ì† ë„ì „í•´ë³´ì„¸ìš”.'],
      bad: ['ìœ„í—˜ì„ ê°ìˆ˜í–ˆêµ°ìš”.', 'ë‹¤ìŒì—” ë” ë‚˜ì„ ê±°ì˜ˆìš”.', 'ê¸°íšŒëŠ” ë‹¤ì‹œ ì˜µë‹ˆë‹¤.'],
      neutral: ['ì„¸ìƒì€ ëŠ˜ ì˜ˆì¸¡í•  ìˆ˜ ì—†ì£ .', 'ì•„ë¬´ ì¼ë„ ì—†ì„ ë•Œê°€ ê°€ì¥ ìœ„í—˜í•©ë‹ˆë‹¤.']
    };
    const phrase = phrases[type][Math.floor(Math.random() * phrases[type].length)];
    document.getElementById('ai').textContent = `ğŸ§  AI ì¡°ì–¸ì: "${phrase}"`;
  };

  const clickBtn = document.getElementById('clickBtn');
  const resetBtn = document.getElementById('resetBtn');
  const shareBtn = document.getElementById('shareBtn');

  clickBtn.onclick = () => {
    if (tries >= MAX_TRIES) return;

    clickBtn.disabled = true;
    document.getElementById('result').textContent = 'ê¸°íšŒë¥¼ íƒìƒ‰ ì¤‘...';

    setTimeout(() => {
      const rand = Math.random();
      let outcome = {};

      if (rand < 0.3) {
        outcome = { text: 'ğŸ˜± ì†í•´ë¥¼ ë´¤ìŠµë‹ˆë‹¤!', type: 'bad', points: -10, gold: 0 };
      } else if (rand < 0.6) {
        outcome = { text: 'ğŸ¤” ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', type: 'neutral', points: 0, gold: 1 };
      } else {
        outcome = { text: 'ğŸ‰ ëŒ€ë°•! ëˆì„ ë²Œì—ˆìŠµë‹ˆë‹¤!', type: 'good', points: 10, gold: 5 };
      }

      if (shield && outcome.points < 0) {
        outcome.points = 0;
        shield = false;
      }
      if (double && outcome.points > 0) {
        outcome.points *= 2;
        double = false;
      }
      if (jackpot100 && Math.random() < 0.01) {
        outcome.gold *= 100;
      } else if (jackpot10 && Math.random() < 0.10) {
        outcome.gold *= 10;
      }

      score += outcome.points;
      gold += outcome.gold;
      walletGold += outcome.gold + outcome.points;
      if (walletGold < 0) walletGold = 0;

      tries++;

      document.getElementById('result').textContent = outcome.text;
      document.getElementById('result').className = outcome.type;

      const loot = getLoot();
      if (loot) {
        lootInventory[loot]++;
        localStorage.setItem('lootInventory', JSON.stringify(lootInventory));
        const msg = document.createElement('div');
        msg.innerHTML = `ğŸ ì „ë¦¬í’ˆ íšë“: <strong>${loot}</strong>! (ì´ ${lootInventory[loot]}ê°œ)`;
        document.getElementById('history').prepend(msg);
      }

      const log = document.createElement('div');
      log.textContent = `[${new Date().toLocaleTimeString()}] ${outcome.text} (${outcome.points >= 0 ? '+' : ''}${outcome.points}ì , +${outcome.gold}G)`;
      log.className = outcome.type;
      document.getElementById('history').prepend(log);

      aiSay(outcome.type);
      updateUI();

      clickBtn.disabled = false;

      if (tries >= MAX_TRIES) {
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('highScore', highScore);
        }
        document.getElementById('result').textContent = `ğŸ¯ ${MAX_TRIES}íšŒ ì™„ë£Œ! ìµœê³  ê¸°ë¡: ${highScore}ì `;
        clickBtn.style.display = 'none';
        resetBtn.style.display = 'block';
      }
    }, 500);
  };

  resetBtn.onclick = () => {
    score = 0;
    gold = 0;
    tries = 0;
    shield = false;
    double = false;
    jackpot100 = false;
    jackpot10 = false;

    // ì „ë¦¬í’ˆì€ ì €ì¥ ìœ ì§€í•˜ë¯€ë¡œ ì´ˆê¸°í™” ì•ˆ í•¨ (ì›í•˜ë©´ ì§€ìš°ë„ë¡ ìˆ˜ì • ê°€ëŠ¥)
    document.getElementById('history').innerHTML = '';

    extraTurns = parseInt(localStorage.getItem('extraTurns') || '0');
    lootBoost = parseInt(localStorage.getItem('lootBoost') || '0');
    MAX_TRIES = MAX_TRIES_BASE + extraTurns;

    clickBtn.style.display = 'block';
    resetBtn.style.display = 'none';
    document.getElementById('result').textContent = 'ê¸°íšŒë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...';

    updateUI();
  };

  function buyItem(type, price) {
    if (walletGold < price) {
      alert('ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
      return;
    }
    walletGold -= price;

    if (type === 'double') double = true;
    else if (type === 'shield') shield = true;
    else if (type === 'jackpot100') jackpot100 = true;
    else if (type === 'jackpot10') jackpot10 = true;
    else if (type === 'extraTurns') {
      localStorage.setItem('extraTurns', '10');
      alert('ë‹¤ìŒ ê²Œì„ì— +10íšŒ ì ìš©ë©ë‹ˆë‹¤.');
    }
    else if (type === 'lootBoost') {
      localStorage.setItem('lootBoost', '1');
      alert('ë‹¤ìŒ ê²Œì„ì— ì „ë¦¬í’ˆ í™•ë¥  +5% ì ìš©ë©ë‹ˆë‹¤.');
    }
    updateUI();
  }

  // ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
  shareBtn.onclick = () => {
    let shareText = `ğŸ’« ê²°í•ì˜ ê³ ë¦¬ ê²Œì„ ê¸°ë¡ ğŸ’«\nìµœê³  ê¸°ë¡: ${highScore}ì \ní˜„ì¬ ì ìˆ˜: ${score}ì \nê³¨ë“œ: ${gold}G\nì§€ê°‘: ${walletGold}G\nì „ë¦¬í’ˆ:\n`;
    for (const item in lootInventory) {
      if (lootInventory[item] > 0) {
        shareText += `- ${item} x${lootInventory[item]}\n`;
      }
    }
    if (navigator.share) {
      navigator.share({
        title: 'ê²°í•ì˜ ê³ ë¦¬ ê²Œì„ ê¸°ë¡',
        text: shareText,
      }).catch(() => {
        alert('ê³µìœ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      });
    } else {
      // fallback: ì¹´í†¡ ê³µìœ  URL (ë‹¨ìˆœ í…ìŠ¤íŠ¸ ë³µì‚¬ ì•ˆë‚´)
      prompt('ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ì¹´ì¹´ì˜¤í†¡ ë“±ì— ê³µìœ í•˜ì„¸ìš”:', shareText);
    }
  };

  updateUI();
</script>
</body>
</html>